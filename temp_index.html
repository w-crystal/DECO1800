<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Harmony</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <aside class="sidebar">
    <div class="logo">
        <span class="material-icons">album</span>
        <span class="logo-text">Harmony</span>
    </div>

    <a href="#" class="nav-item create-event-btn" id="openCreateModal">
        <span class="material-icons">add_circle_outline</span>
        <span class="nav-text">Create Event</span>
    </a>

    <a href="index.html" class="nav-item">
        <span class="material-icons">home</span>
        <span class="nav-text">Home</span>
    </a>
    <a href="#" class="nav-item">
        <span class="material-icons">email</span>
        <span class="nav-text">Blog</span>
    </a>
    <a href="#" class="nav-item">
        <span class="material-icons">event</span>
        <span class="nav-text">Upcoming Events</span>
    </a>
    <a href="#" class="nav-item">
        <span class="material-icons">person</span>
        <span class="nav-text">My Profile</span>
    </a>
  </aside>

  <header class="header">
    <div class="search-bar">
      <input type="text" placeholder="Search">
    </div>
  </header>

  <main class="main-container">
    <div class="card-container" id="cardContainer">
      <!-- Existing and newly created event cards will be displayed here -->
    </div>
  </main>

  <!-- Create Event Modal with Wizard -->
  <div class="modal" id="createEventModal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog" role="dialog" aria-modal="true">
      <div class="wizard-container">
        <div class="modal-header" style="padding: 16px 20px; border-bottom: none;">
             <h2 style="margin:0;">Create a New Event</h2>
             <button class="icon-btn modal-close-btn" aria-label="Close">
                <span class="material-icons">close</span>
             </button>
        </div>

        <!-- Progress Bar -->
        <div class="wizard-progress">
          <div class="progress-step active" data-step="1">1</div>
          <div class="progress-step" data-step="2">2</div>
          <div class="progress-step" data-step="3">3</div>
          <div class="progress-step" data-step="4">4</div>
          <div class="progress-step" data-step="5">5</div>
          <div class="progress-step" data-step="6">6</div>
        </div>

        <form id="createEventForm" novalidate>
          <!-- Step 1: Event Details -->
          <div id="step-1" class="wizard-step active">
            <h4>Step 1: Core Details</h4>
            <div class="modal-body">
              <label class="field"><span>Event Name (Required)</span><input type="text" name="title" placeholder="e.g. Campus Jazz Night" required></label>
              <label class="field"><span>Activity Type (Required)</span><select name="activityType" required><option value="">Select an activity type...</option><option value="Live Show">Live Show</option><option value="Workshop">Workshop</option><option value="Community Meetup">Community Meetup</option><option value="Open Mic">Open Mic</option></select></label>
              <label class="field"><span>Genre (Required)</span><select name="genre" required><option value="">Select a genre...</option><option value="Rock">Rock</option><option value="Pop">Pop</option><option value="Jazz">Jazz</option><option value="Classical">Classical</option><option value="Hip-Hop">Hip-Hop</option><option value="EDM">EDM</option></select></label>
            </div>
          </div>
          <!-- Step 2: Scheduling -->
          <div id="step-2" class="wizard-step">
            <h4>Step 2: Scheduling</h4>
            <div class="modal-body">
              <label class="field"><span>Date (Required)</span><input type="date" name="date" required></label>
              <label class="field"><span>Start Time (Required)</span><input type="time" name="time" required></label>
              <label class="field"><span>Duration (Required)</span><input type="text" name="duration" placeholder="e.g., 2 hours" required></label>
            </div>
          </div>
          <!-- Step 3: Location -->
          <div id="step-3" class="wizard-step">
              <h4>Step 3: Location</h4>
              <div class="modal-body"><label class="field"><span>Location / Venue (Required)</span><input type="text" name="location" placeholder="e.g., Brisbane City Hall" required></label></div>
          </div>
          <!-- Step 4: Additional Details -->
          <div id="step-4" class="wizard-step">
            <h4>Step 4: Additional Details</h4>
            <div class="modal-body">
              <div class="field"><label class="checkbox-label"><input type="checkbox" id="ticketRequiredCheck"> Ticket Required</label><div id="costField" style="display: none; margin-top: 10px;"><span>Ticket Cost</span><input type="text" name="cost" placeholder="e.g., $15 or 'Free with booking'"></div></div>
              <label class="field"><span>Age Range</span><select name="ageRange"><option value="All Ages">All Ages</option><option value="Kids">Kids</option><option value="Teens (13+)">Teens (13+)</option><option value="Adults (18+)">Adults (18+)</option><option value="Seniors (60+)">Seniors (60+)</option></select></label>
              <label class="field"><span>Event Image</span><input type="file" name="image" accept="image/*"></label>
              <div class="field"><span>Tags</span><div class="tag-selection"><label><input type="checkbox" name="tags" value="Recruiting"> Recruiting</label><label><input type="checkbox" name="tags" value="Community"> Community</label><label><input type="checkbox" name="tags" value="Showcase"> Performance Showcase</label><label><input type="checkbox" name="tags" value="Concert"> Concert</label><label><input type="checkbox" name="tags" value="Fundraiser"> Fundraiser</label><label><input type="checkbox" name="tags" value="Family Friendly"> Family Friendly</label><label><input type="checkbox" name="tags" value="Limited Seats"> Limited Seats</label></div></div>
            </div>
          </div>
          <!-- Step 5: Description -->
          <div id="step-5" class="wizard-step">
              <h4>Step 5: Event Description</h4>
              <div class="modal-body"><label class="field"><span>Description</span><textarea name="description" rows="6" placeholder="Tell everyone about your event..."></textarea></label></div>
          </div>
          <!-- Step 6: Summary -->
          <div id="step-6" class="wizard-step">
              <h4>Step 6: Review & Submit</h4>
              <div id="summary-review" class="summary-review"></div>
              <div class="field terms-field"><label class="checkbox-label"><input type="checkbox" id="termsAndConditions" required> I agree to the <a href="#" id="openTermsLink">Terms and Conditions</a></label></div>
          </div>
          <!-- Navigation -->
          <div class="wizard-navigation">
            <button type="button" id="prevBtn" class="btn ghost">Previous</button>
            <button type="button" id="nextBtn" class="btn primary">Next</button>
            <button type="submit" id="submitBtn" class="btn primary" style="display: none;" disabled>Create Event</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Terms and Conditions Modal -->
  <div class="modal" id="termsModal">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog">
        <div class="modal-header">
            <h3>Terms and Conditions & Privacy Policy</h3>
            <button type="button" class="modal-close-btn">&times;</button>
        </div>
        <div class="modal-content">
            <h4>1. Introduction</h4><p>Welcome to our services. By accessing or using our platform, you agree to these Terms and Conditions and our Privacy Policy. If you do not agree, please discontinue use of our services immediately.</p>
            <h4>2. Collection of Personal Data</h4><p>We may collect personal information... All collected personal data will be handled in accordance with this Privacy Policy.</p>
            <h4>3. Collection of Location Data</h4><p>Our services may request access to your deviceâ€™s location... You may disable location sharing in your device settings, but certain features may not function properly.</p>
            <h4>4. Use of Data</h4><p>Your information may be used to: Provide, maintain, and improve our services...</p>
            <h4>5. Sharing and Disclosure</h4><p>We will not sell or rent your personal data... Used to protect our rights, property, or safety, and that of our users.</p>
            <h4>6. Data Retention</h4><p>We retain personal data only as long as necessary to fulfill the purposes outlined here, unless a longer retention period is required by law.</p>
            <h4>7. Security</h4><p>We use reasonable safeguards to protect your information... we cannot guarantee absolute protection.</p>
            <h4>8. User Responsibilities</h4><p>You agree to provide accurate information... You are responsible for maintaining the confidentiality of your login credentials.</p>
            <h4>9. User Rights</h4><p>You have the right to: Access and request a copy of your personal data...</p>
            <h4>10. Changes to These Terms</h4><p>We may update these Terms and Conditions and Privacy Policy from time to time...</p>
            <h4>11. Contact Us</h4><p>If you have questions about these Terms and Conditions or this Privacy Policy, please contact us at: [harmonyhelp@gmail.com]</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn primary modal-close-btn">Close</button>
        </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // --- Constants and Global Variables ---
      const openModalBtn = document.getElementById('openCreateModal');
      const createModal = document.getElementById('createEventModal');
      const cardContainer = document.getElementById('cardContainer');
      const form = document.getElementById('createEventForm');
      const LS_KEY = 'harmony_events_v1';
      
      // Wizard Elements
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const submitBtn = document.getElementById('submitBtn');
      const steps = Array.from(document.querySelectorAll('.wizard-step'));
      const progressSteps = Array.from(document.querySelectorAll('.progress-step'));
      const ticketCheck = document.getElementById('ticketRequiredCheck');
      const costField = document.getElementById('costField');
      const termsCheck = document.getElementById('termsAndConditions');
      
      // T&C Modal elements
      const termsModal = document.getElementById('termsModal');
      const openTermsLink = document.getElementById('openTermsLink');
      const allModalCloseBtns = document.querySelectorAll('.modal-close-btn, .modal-backdrop');

      let currentStep = 1;

      // --- Core Modal Functions ---
      function openCreateModal() {
        createModal.setAttribute('aria-hidden', 'false');
        document.body.classList.add('no-scroll');
      }

      function closeCreateModal() {
        createModal.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('no-scroll');
        if (form) form.reset();
        // Reset wizard to first step
        currentStep = 1;
        showStep(currentStep);
        submitBtn.disabled = true;
        costField.style.display = 'none';
      }
      
      // --- Card Rendering Functions ---
      function trimStr(v) { return typeof v === 'string' ? v.trim() : ''; }
      function formatLocalDateTime(dt) { try { return new Intl.DateTimeFormat(undefined, { weekday: 'short', year: 'numeric', month: 'short', day: '2-digit', hour: 'numeric', minute: '2-digit' }).format(dt); } catch(e) { return ''; } }
      function buildCardHTML(data) {
        const title = trimStr(data.title) || 'Untitled';
        const tag = trimStr(data.tag);
        let displayTime = '';
        if (data.timeISO) {
          const dt = new Date(data.timeISO);
          if (!isNaN(dt.getTime())) displayTime = formatLocalDateTime(dt);
        }
        const tagHTML = tag ? `<span class="tag">${tag.split(',').join('</span><span class="tag">')}</span>` : '';
        const imgTag = data.image ? `<img src="${String(data.image).replace(/"/g,'&quot;')}" alt="${String(title).replace(/"/g,'&quot;')}">` : '<img alt="Default Event Image">';
        return `<div class="event-card">${imgTag}<div class="card-content"><h3>${title}</h3><p>${displayTime}</p><div class="card-footer">${tagHTML}<span class="material-icons bookmark">bookmark_border</span></div></div></div>`;
      }
      function appendCard(cardData, toTop) {
        const wrapper = document.createElement('div');
        wrapper.innerHTML = buildCardHTML(cardData).trim();
        const card = wrapper.firstElementChild;
        if (!cardContainer) return;
        if (toTop && cardContainer.firstChild) {
          cardContainer.insertBefore(card, cardContainer.firstChild);
        } else {
          cardContainer.appendChild(card);
        }
      }
      function loadEvents() { try { const raw = localStorage.getItem(LS_KEY); return raw ? JSON.parse(raw) : []; } catch (e) { return []; } }
      function saveEvents(events) { try { localStorage.setItem(LS_KEY, JSON.stringify(events)); } catch (e) {} }
      function renderSaved() { const events = loadEvents(); cardContainer.innerHTML = ''; events.forEach(ev => appendCard(ev, false)); }

      // --- Wizard Logic ---
      function showStep(stepNumber) {
        steps.forEach(step => step.classList.remove('active'));
        document.querySelector(`#step-${stepNumber}`).classList.add('active');
        progressSteps.forEach((step, index) => {
            if (index < stepNumber - 1) { step.classList.add('completed'); step.classList.remove('active'); }
            else if (index === stepNumber - 1) { step.classList.add('active'); step.classList.remove('completed'); }
            else { step.classList.remove('active', 'completed'); }
        });
        prevBtn.style.display = stepNumber === 1 ? 'none' : 'inline-block';
        nextBtn.style.display = stepNumber === steps.length ? 'none' : 'inline-block';
        submitBtn.style.display = stepNumber === steps.length ? 'inline-block' : 'none';
      }
      function validateStep(stepNumber) {
          const currentStepFields = steps[stepNumber - 1].querySelectorAll('[required]:not(:disabled)');
          for (const field of currentStepFields) {
              if ((!field.value.trim() && field.type !== 'checkbox') || (field.type === 'checkbox' && !field.checked)) {
                  const fieldLabel = field.closest('.field, .terms-field').querySelector('span, .checkbox-label');
                  const fieldName = fieldLabel ? fieldLabel.textContent.replace('(Required)', '').trim() : 'the required field';
                  alert(`Please complete: ${fieldName}`);
                  field.focus();
                  return false;
              }
          }
          return true;
      }
      function populateSummary() {
          const fd = new FormData(form);
          const summaryContainer = document.getElementById('summary-review');
          let html = '<ul>';
          html += `<li><strong>Name:</strong> ${fd.get('title') || 'N/A'}</li>`;
          html += `<li><strong>Activity:</strong> ${fd.get('activityType') || 'N/A'}</li>`;
          html += `<li><strong>Date & Time:</strong> ${fd.get('date')} at ${fd.get('time')}</li>`;
          html += `<li><strong>Location:</strong> ${fd.get('location') || 'N/A'}</li>`;
          html += `<li><strong>Cost:</strong> ${ticketCheck.checked ? (fd.get('cost') || 'TBC') : 'Free'}</li>`;
          const tags = fd.getAll('tags');
          if (tags.length > 0) html += `<li><strong>Tags:</strong> ${tags.join(', ')}</li>`;
          html += '</ul>';
          summaryContainer.innerHTML = html;
      }
      nextBtn.addEventListener('click', () => {
        if (validateStep(currentStep)) {
            if (currentStep < steps.length) {
                currentStep++;
                if (currentStep === steps.length) populateSummary();
                showStep(currentStep);
            }
        }
      });
      prevBtn.addEventListener('click', () => { if (currentStep > 1) { currentStep--; showStep(currentStep); } });
      
      // --- T&C Modal Logic ---
      openTermsLink.addEventListener('click', (e) => { e.preventDefault(); termsModal.style.display = 'flex'; });
      allModalCloseBtns.forEach(btn => {
          btn.addEventListener('click', () => {
              if (createModal.getAttribute('aria-hidden') === 'false') closeCreateModal();
              if (termsModal.style.display === 'flex') termsModal.style.display = 'none';
          });
      });

      // --- Event Listeners ---
      openModalBtn.addEventListener('click', (e) => { e.preventDefault(); openCreateModal(); });
      ticketCheck.addEventListener('change', () => { costField.style.display = ticketCheck.checked ? 'block' : 'none'; });
      termsCheck.addEventListener('change', () => { submitBtn.disabled = !termsCheck.checked; });
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeCreateModal(); });
      
      // --- FORM SUBMISSION ---
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        if (!termsCheck.checked) { alert('You must agree to the Terms and Conditions.'); return; }

        const fd = new FormData(form);
        const date = trimStr(fd.get('date'));
        const time = trimStr(fd.get('time'));
        const dateTimeString = `${date}T${time}`;
        const dtLocal = new Date(dateTimeString);
        const tags = fd.getAll('tags');
        if (fd.get('genre')) tags.unshift(fd.get('genre'));

        const payload = {
          title: trimStr(fd.get('title')),
          tag: tags.join(', '),
          image: '', // File upload handling requires server-side logic
          location: trimStr(fd.get('location')),
          timeISO: !isNaN(dtLocal.getTime()) ? dtLocal.toISOString() : null,
          description: trimStr(fd.get('description'))
        };
        
        appendCard(payload, true); // Add to page immediately
        
        const currentEvents = loadEvents();
        currentEvents.unshift(payload);
        saveEvents(currentEvents);
        
        alert('Event Created Successfully!');
        closeCreateModal();
      });

      // --- Initial Page Load ---
      renderSaved();
      showStep(currentStep);
    });
  </script>
</body>
</html>