<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="new.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <title>Harmony</title>
</head>
<body>
    <aside class="sidebar">
        <div class="logo">
            <span class="material-icons">album</span>
            <span class="logo-text">Harmony</span>
        </div>

        <a href="create.html" class="nav-item create-event-btn">
            <span class="material-icons">add_circle_outline</span>
            <span class="nav-text">Create Event</span>
        </a>

        <a href="index.html" class="nav-item">
            <span class="material-icons">home</span>
            <span class="nav-text">Home</span>
        </a>
        <a href="#" class="nav-item">
            <span class="material-icons">email</span>
            <span class="nav-text">Blog</span>
        </a>
        <a href="upcomingevents.html" class="nav-item">
            <span class="material-icons">event</span>
            <span class="nav-text">Upcoming Events</span>
        </a>
        <a href="#" class="nav-item">
            <span class="material-icons">person</span>
            <span class="nav-text">My Profile</span>
        </a>
    </aside>

    <div class="main-container">
        <div class="search-page-container">
            <!-- Search Header with Bar and Tags -->
            <div class="search-header">
                <h1>?</h1>
                <form class="search-bar-main">
                    <span class="material-icons">search</span>
                    <input type="text" placeholder="Search by name, genre, or location...">
                </form>

                <div class="search-tags">
                    <button class="tag-filter active">All</button>
                    <button class="tag-filter">Recruiting</button>
                    <button class="tag-filter">Live Show</button>
                    <button class="tag-filter">Community</button>
                    <button class="tag-filter">Fundraiser</button>
                </div>
            </div>
        </div>
        <section id="records"></section>
        <div class="expand-content"></div>
    </div>
</body>

<script>
    function iterateRecords(data) {
        console.log("Data returned: " + JSON.stringify(data));
        var records = data.results;
        Object.values(records).forEach(value => {
            var subject = value["subject"];
            var venue = value["venue"];
            var start_datetime = value["start_datetime"];
            var description = value["description"];
            var event_type = value["event_type"];

            if(subject && venue && start_datetime && description && event_type ){
                    const expanded = $('<div class="expanded-con">').append(
                        $('<p>').text("Time: " + start_datetime),
                        $('<p>').text("Description: " + description),
                        $('<p>').text("Location: " + venue),
                        $('<p>').text("Event type: " + event_type)
                    );
                
                    const card = $('<section class="record">').append(
                        $('<h3>').text(subject),
                        $('<p>').text(start_datetime) 
                    );

                    card.data('record', {
                        subject, venue, start_datetime, description, event_type
                    });
                    $("#records").append(card);
            }
        });
    }

    // const document.addEventListener("click", function() {
    //     // Your code to run since DOM is loaded and ready
    // });

    $(document).on('click', '.record', function() {
        const data = $(this).data('record'); // grab stored record

        const details = `
            <div class="drawer">
                <button class="drawer-close">Ã—</button>
                <h2>${data.subject}</h2>
                <p><strong>Start time:</strong> ${data.start_datetime}</p>
                <p><strong>Venue:</strong> ${data.venue}</p>
                <p><strong>Description:</strong> ${data.description}</p>
                <p><strong>Event type:</strong> ${data.event_type}</p>
            </div>
        `;
        $('.expand-content').html(details).addClass('open');
    });

        // close drawer
    $(document).on('click', '.drawer-close', function() {
        $('.expand-content').removeClass('open').empty();
    });

    $(document).ready(function() {
        var data ={};
        const apiURL = "https://data.brisbane.qld.gov.au/api/explore/v2.1/catalog/datasets/music-events/records";

        const requestParams = {
            select : "subject,venue,start_datetime,description,event_type"
        };

        const queryString = new URLSearchParams(requestParams).toString();
        const fullURL = apiURL + '?' + queryString;
        console.log("URL: " + fullURL)

        fetch(fullURL)
            .then(response => response.json())
            .then(data => iterateRecords(data))
            .catch(error => console.error("Error fetching data:", error));
    });

    document.addEventListener("DOMContentLoaded", function() {
        // Fetch the sidebar content
        fetch('sidebar.html')
            .then(response => response.text())
            .then(data => {
                // Inject the sidebar HTML into the placeholder
                document.getElementById('sidebar-placeholder').innerHTML = data;

                // --- Script to set the active page ---
                // Get the current page's filename (e.g., "search.html")
                const currentPage = window.location.pathname.split("/").pop();

                // Find all the navigation links within the newly added sidebar
                const navLinks = document.querySelectorAll('#sidebar-placeholder .nav-item');

                // Loop through each link
                navLinks.forEach(link => {
                    const linkPage = link.getAttribute('href');
                    
                    // If the link's href matches the current page, add the 'active' class
                    if (linkPage === currentPage) {
                        link.classList.add('active');
                    }
                });
            })
            .catch(error => {
                console.error('Error fetching the sidebar:', error);
                // Optional: Show an error message if the sidebar can't be loaded
                document.getElementById('sidebar-placeholder').innerHTML = '<p>Error loading navigation.</p>';
            });
    });

    
        // Basic interactivity for the tags
        document.addEventListener('DOMContentLoaded', function () {
            const tagFilters = document.querySelectorAll('.tag-filter');

            tagFilters.forEach(button => {
                button.addEventListener('click', function () {

                    tagFilters.forEach(btn => btn.classList.remove('active'));
                    

                    this.classList.add('active');


                    console.log(`Filtering by: ${this.textContent}`);
                });
            });
        });
</script>

