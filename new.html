<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="new.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <title>Harmony</title>
</head>
<body>
    <aside class="sidebar">
        <div class="logo">
            <span class="material-icons">album</span>
            <span class="logo-text">Harmony</span>
        </div>

        <a href="create.html" class="nav-item create-event-btn">
            <span class="material-icons">add_circle_outline</span>
            <span class="nav-text">Create Event</span>
        </a>

        <a href="index.html" class="nav-item">
            <span class="material-icons">home</span>
            <span class="nav-text">Home</span>
        </a>
        <a href="#" class="nav-item">
            <span class="material-icons">email</span>
            <span class="nav-text">Blog</span>
        </a>
        <a href="#" class="nav-item">
            <span class="material-icons">event</span>
            <span class="nav-text">Upcoming Events</span>
        </a>
        <a href="#" class="nav-item">
            <span class="material-icons">person</span>
            <span class="nav-text">My Profile</span>
        </a>
    </aside>

    <header class="header">
        <div class="search-bar">
            <input type="text" placeholder="Search">
        </div>
    </header>


    <article id="layout">
        <div class="user-btn">
            <h2 class="btn"><a href="new.html" style="text-decoration: none;">I want to join eventsðŸŽµ</a></h2>
            <h2 class="btn"><a href="create.html" style="text-decoration: none;">I want to create eventsðŸ’°</a></h2>
        </div>
        <section id="records"></section>
        <div class="expand-content"></div>
        
    </article>

</body>

<script>
    function iterateRecords(data) {
        console.log("Data returned: " + JSON.stringify(data));
        var records = data.results;
        Object.values(records).forEach(value => {
            var subject = value["subject"];
            var venue = value["venue"];
            var start_datetime = value["start_datetime"];
            var description = value["description"];
            var event_type = value["event_type"];

            if(subject && venue && start_datetime && description && event_type ){
                    const expanded = $('<div class="expanded-con">').append(
                        $('<p>').text("Time: " + start_datetime),
                        $('<p>').text("Description: " + description),
                        $('<p>').text("Location: " + venue),
                        $('<p>').text("Event type: " + event_type)
                    );
                
                    const card = $('<section class="record">').append(
                        $('<h3>').text(subject),
                        $('<p>').text(start_datetime) 
                    );

                    card.data('record', {
                        subject, venue, start_datetime, description, event_type
                    });
                    $("#records").append(card);
            }
        });
    }

    // const document.addEventListener("click", function() {
    //     // Your code to run since DOM is loaded and ready
    // });

    $(document).on('click', '.record', function() {
        const data = $(this).data('record'); // grab stored record

        const details = `
            <div class="drawer">
                <button class="drawer-close">Ã—</button>
                <h2>${data.subject}</h2>
                <p><strong>Start time:</strong> ${data.start_datetime}</p>
                <p><strong>Venue:</strong> ${data.venue}</p>
                <p><strong>Description:</strong> ${data.description}</p>
                <p><strong>Event type:</strong> ${data.event_type}</p>
            </div>
        `;
        $('.expand-content').html(details).addClass('open');
    });

        // close drawer
    $(document).on('click', '.drawer-close', function() {
        $('.expand-content').removeClass('open').empty();
    });

    $(document).ready(function() {
        var data ={};
        const apiURL = "https://data.brisbane.qld.gov.au/api/explore/v2.1/catalog/datasets/music-events/records";

        const requestParams = {
            select : "subject,venue,start_datetime,description,event_type"
        };

        const queryString = new URLSearchParams(requestParams).toString();
        const fullURL = apiURL + '?' + queryString;
        console.log("URL: " + fullURL)

        fetch(fullURL)
            .then(response => response.json())
            .then(data => iterateRecords(data))
            .catch(error => console.error("Error fetching data:", error));
    });
</script>
